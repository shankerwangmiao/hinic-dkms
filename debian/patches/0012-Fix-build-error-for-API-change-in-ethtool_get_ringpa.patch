From: Miao Wang <shankerwangmiao@gmail.com>
Date: Fri, 11 Jul 2025 01:16:36 +0800
Subject: Fix build error for API change in ethtool_get_ringparam

---
 hinic/Makefile                                  |  1 +
 hinic/feature_test_ethtool_get_ringparam_four.c | 12 ++++++++++++
 hinic/hinic_ethtool.c                           | 16 ++++++++++++----
 3 files changed, 25 insertions(+), 4 deletions(-)
 create mode 100644 hinic/feature_test_ethtool_get_ringparam_four.c

diff --git a/hinic/Makefile b/hinic/Makefile
index f996a53..afbe112 100644
--- a/hinic/Makefile
+++ b/hinic/Makefile
@@ -22,6 +22,7 @@ feature_test := \
 	struct_rxfh \
 	add_class_one \
 	napi_add_tx_weight \
+	ethtool_get_ringparam_four \
 
 $(obj)/feature_test_%.result: $(src)/feature_test_%.c
 	$(Q)echo "Checking feature test for $*..."; \
diff --git a/hinic/feature_test_ethtool_get_ringparam_four.c b/hinic/feature_test_ethtool_get_ringparam_four.c
new file mode 100644
index 0000000..ec273b9
--- /dev/null
+++ b/hinic/feature_test_ethtool_get_ringparam_four.c
@@ -0,0 +1,12 @@
+#include <linux/netdevice.h>
+#include <linux/ethtool.h>
+
+
+extern void foo_get_ringparam(struct net_device *netdev,
+			      struct ethtool_ringparam *ring,
+			      struct kernel_ethtool_ringparam *kernel_ring,
+			      struct netlink_ext_ack *extack);
+
+struct ethtool_ops foo = {
+	.get_ringparam = foo_get_ringparam,
+};
diff --git a/hinic/hinic_ethtool.c b/hinic/hinic_ethtool.c
index b039dac..5684331 100644
--- a/hinic/hinic_ethtool.c
+++ b/hinic/hinic_ethtool.c
@@ -924,9 +924,13 @@ static int hinic_nway_reset(struct net_device *netdev)
 }
 
 static void hinic_get_ringparam(struct net_device *netdev,
-				struct ethtool_ringparam *ring,
+				struct ethtool_ringparam *ring
+#ifdef HAVE_ETHTOOL_GET_RINGPARAM_FOUR
+				,
 				struct kernel_ethtool_ringparam *kernel_ring,
-				struct netlink_ext_ack *extack)
+				struct netlink_ext_ack *extack
+#endif
+)
 {
 	struct hinic_nic_dev *nic_dev = netdev_priv(netdev);
 
@@ -952,9 +956,13 @@ static void hinic_update_qp_depth(struct hinic_nic_dev *nic_dev,
 }
 
 static int hinic_set_ringparam(struct net_device *netdev,
-			       struct ethtool_ringparam *ring,
+			       struct ethtool_ringparam *ring
+#ifdef HAVE_ETHTOOL_GET_RINGPARAM_FOUR
+				   ,
 			       struct kernel_ethtool_ringparam *kernel_ring,
-			       struct netlink_ext_ack *extack)
+			       struct netlink_ext_ack *extack
+#endif
+)
 {
 	struct hinic_nic_dev *nic_dev = netdev_priv(netdev);
 	u16 new_sq_depth, new_rq_depth;
